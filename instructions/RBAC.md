
***

## Роли в системе SellerProof

Система использует три роли с четкой иерархией:

### Admin (владелец организации)

Это полный владелец организации со всеми правами:

**Управление видео:**
- Просмотр, загрузка, скачивание и публикация видео
- Поиск по всем видео организации (включая видео других пользователей)
- Удаление видео
- Отзыв публичного доступа к видео

**Управление организацией:**
- Просмотр и редактирование настроек организации
- Изменение названия организации
- Полное удаление организации (включая все данные)
- Создание новых организаций

**Управление пользователями:**
- Приглашение новых участников в организацию
- Просмотр списка всех членов
- Изменение ролей участников (может назначить `manager` или `user`)
- Изменение статуса участников (активен/приостановлен)
- Удаление участников из организации
- Управление приглашениями (просмотр, отмена)

**Управление подпиской:**
- Просмотр деталей подписки и использования ресурсов
- Управление тарифным планом (доступ к `admin:manage_subscriptions`)
- **Важно:** Подписка привязана к владельцу организации - все участники используют его квоту хранилища и лимиты

**Аудит:**
- Доступ к полным логам аудита организации
- Просмотр истории действий всех участников

***

### Manager (менеджер)

Управляющая роль с ограничениями:

**Может:**
- Все операции с видео (просмотр, загрузка, публикация, скачивание)
- Поиск по всем видео организации (не ограничен только своими видео)
- Отзыв публичного доступа к видео
- Приглашать новых пользователей (только с ролью `user`)
- Изменять статус участников (активен/приостановлен), **но только для роли `user`**
- **Не может** изменять статус других `manager` или `admin`
- Просматривать информацию об организации

**Не может:**
- Изменять настройки организации
- Удалять организацию
- Назначать других `manager`'ов
- Изменять роли участников (нет доступа к смене ролей)
- Удалять участников из организации
- Управлять подписками
- Просматривать аудит-логи

***

### User (обычный пользователь)

Базовая роль с минимальными правами:

**Может:**
- **Загружать видео** (использует квоту подписки владельца организации)
- Просматривать **только свои** видео
- Скачивать **только свои** видео
- Искать только по своим видео (фильтр `uploaded_by`)
- Редактировать свой профиль
- Принимать приглашения в организации

**Не может:**
- Просматривать видео других пользователей организации
- Публиковать видео в публичный доступ
- Отзывать публичный доступ к видео
- Управлять участниками
- Изменять настройки организации
- Приглашать новых участников
- Просматривать список членов организации
- Просматривать аудит-логи

***

## Ключевые особенности системы ролей

### 1. Иерархия доступа к видео
- **Admin/Manager**: Видят и управляют всеми видео организации
- **User**: Видит только свои загруженные видео

### 2. Подписка и квоты
- Подписка привязана к **владельцу организации** (`org.OwnerID`)
- Все участники используют квоту владельца:
  - FREE план владельца = 0 МБ → никто не может загружать
  - PRO план владельца = 100 ГБ → все могут загружать в пределах этой квоты
- Проверка лимитов происходит при инициализации загрузки

### 3. Защита от злоупотреблений
- **Manager** не может управлять другими `manager` или `admin`
- **User** может завершить загрузку своего видео даже после переключения организации (проверка по `uploaded_by`, а не `org_id`)
- Только загрузчик видео может генерировать URL для загрузки частей (защита от IDOR)

### 4. Публикация видео
- Только **Admin** и **Manager** могут публиковать видео
- Публикация создает уникальный токен для публичного доступа
- Публичные ссылки работают без аутентификации
- Отзыв доступа помечает токен как `revoked` (видео остается в системе)

***

## Типичные сценарии использования

### Сценарий 1: Команда с FREE пользователем
1. **User A** (FREE план) создает организацию → не может загружать видео
2. **User B** (PRO план) приглашает User A в свою организацию
3. User A переключается на организацию User B → теперь может загружать видео в рамках квоты PRO плана

### Сценарий 2: Делегирование управления
1. **Admin** создает организацию (PRO план)
2. Приглашает **Manager** для повседневного управления видео
3. Manager публикует и отзывает видео, но не может удалить организацию или изменить подписку

### Сценарий 3: Большая команда контент-мейкеров
1. **Admin** (BUSINESS план, 500 ГБ) создает организацию
2. Приглашает 10 **User** для загрузки видео
3. Назначает 2 **Manager** для модерации и публикации
4. Все 10 User загружают видео в общую квоту 500 ГБ
5. Manager проверяют и публикуют лучшие видео

***

**Владелец организации (admin/owner)** - это самая привилегированная роль с полным контролем над организацией, её участниками, подписками и всеми ресурсами. Только владелец несет финансовую ответственность за использование ресурсов всеми участниками.