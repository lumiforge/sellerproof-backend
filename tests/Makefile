.PHONY: test build clean help

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
# –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è TEST_URL –∏ TEST_EMAIL_ADDRESS
SERVICE_URL ?= $(TEST_URL)
TEST_EMAIL ?= $(TEST_EMAIL_ADDRESS)
received_code ?= 8ff470
GO_FILES = cmd/test-client/main.go

# –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã
default: test

# –°–±–æ—Ä–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
build:
	@echo "üî® –°–±–æ—Ä–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞..."
	go build -ldflags "-X main.serviceURL=$(SERVICE_URL) -X main.testEmailAddress=$(TEST_EMAIL)" -o test-client ./cmd/test-client
	chmod +x test-client
	@echo "‚úÖ –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
test: build
	@echo "üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è SellerProof Backend"
	@echo "üì° –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–∏—Å—É: $(SERVICE_URL)"
	./test-client

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –±–µ–∑ —Å–±–æ—Ä–∫–∏ (–µ—Å–ª–∏ –±–∏–Ω–∞—Ä–Ω–∏–∫ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
run:
	@echo "üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è SellerProof Backend"
	@echo "üì° –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–∏—Å—É: $(SERVICE_URL)"
	./test-client

# –û—á–∏—Å—Ç–∫–∞
clean:
	@echo "üßπ –û—á–∏—Å—Ç–∫–∞..."
	rm -f test-client
	@echo "‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"

# –ó–∞–ø—É—Å–∫ —Å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–º–∏ –ª–æ–≥–∞–º–∏
debug: build
	@echo "üêõ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–º–∏ –ª–æ–≥–∞–º–∏"
	GODEBUG=http2debug=1 ./test-client

# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (—á–∞—Å—Ç—å 1)
test-register: build
	@echo "üìù –ó–∞–ø—É—Å–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
	@echo "üì° –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–∏—Å—É: $(SERVICE_URL)"
	@echo "üìß Email –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: $(TEST_EMAIL)"
	TEST_MODE=register ./test-client

# –ó–∞–ø—É—Å–∫ –≤—Ö–æ–¥–∞ —Å –∫–æ–¥–æ–º –∏ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ (—á–∞—Å—Ç—å 2)
test-login: build
	@echo "üîê –ó–∞–ø—É—Å–∫ –≤—Ö–æ–¥–∞ —Å –∫–æ–¥–æ–º –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤"
	@echo "üì° –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–∏—Å—É: $(SERVICE_URL)"
	@echo "üìß Email: $(TEST_EMAIL)"
	@echo "üîë –ö–æ–¥ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏: $(received_code)"
	TEST_MODE=login VERIFICATION_CODE=$(received_code) ./test-client

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
deps:
	@echo "üì¶ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
	go mod tidy
	go mod download
	@echo "‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã"

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
fmt:
	@echo "üé® –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞..."
	go fmt ./cmd/test-client/main.go
	@echo "‚úÖ –ö–æ–¥ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
vet:
	@echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞..."
	go vet ./cmd/test-client/main.go
	@echo "‚úÖ –ö–æ–¥ –ø—Ä–æ–≤–µ—Ä–µ–Ω"

# –ü–æ–º–æ—â—å
help:
	@echo "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
	@echo "  build          - –°–±–æ—Ä–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞"
	@echo "  test           - –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤"
	@echo "  test-register  - –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (—á–∞—Å—Ç—å 1)"
	@echo "  test-login     - –ó–∞–ø—É—Å–∫ –≤—Ö–æ–¥–∞ —Å –∫–æ–¥–æ–º –∏ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ (—á–∞—Å—Ç—å 2)"
	@echo "  run            - –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –±–µ–∑ —Å–±–æ—Ä–∫–∏"
	@echo "  clean          - –û—á–∏—Å—Ç–∫–∞"
	@echo "  debug          - –ó–∞–ø—É—Å–∫ —Å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–º–∏ –ª–æ–≥–∞–º–∏"
	@echo "  deps           - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π"
	@echo "  fmt            - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞"
	@echo "  vet            - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞"
	@echo "  help           - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É"